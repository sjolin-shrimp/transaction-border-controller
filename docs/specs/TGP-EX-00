üìó TGP-EX-00 ‚Äî Transaction Gateway Protocol: Browser Extension Runtime

Version: 0.1-draft
Status: Draft
Audience: Extension developers (Chrome MV3, Firefox, Brave, Safari)
Purpose: Defines how a browser extension implements TGP-CP-00 in a compliant, safe, non-custodial manner that passes browser store security requirements.

‚∏ª

1. Purpose & Model

The TGP Extension is the default and recommended Client implementation.

It:
	‚Ä¢	receives x402 signals
	‚Ä¢	parses TGP envelopes
	‚Ä¢	communicates with the user‚Äôs TBC
	‚Ä¢	constructs transactions
	‚Ä¢	forwards them to wallets for signing
	‚Ä¢	routes signed transactions

The extension MUST be:
	‚Ä¢	permission-minimal
	‚Ä¢	non-custodial
	‚Ä¢	non-injective into password or key fields
	‚Ä¢	compliant with Chrome MV3, Safari WKWebExtension, and Firefox standards
	‚Ä¢	secure and transparent

‚∏ª

2. Extension Architecture

Components:
	1.	Background Service Worker (MV3)
	‚Ä¢	short-lived
	‚Ä¢	event-driven
	‚Ä¢	handles TGP queries, TBC calls, transaction routing
	2.	Content Script (optional)
	‚Ä¢	listens for x402 messages emitted by dApps or agents
	‚Ä¢	MUST NOT read sensitive fields
	‚Ä¢	MUST NOT access secure iframes
	3.	UI Panel / Popup
	‚Ä¢	displays TGP status: ‚ÄúTGP Present‚Äù, session info, TBC status
	4.	Local Storage
	‚Ä¢	stores session metadata (non-sensitive)
	‚Ä¢	MUST NOT store private keys
	5.	RPC Module
	‚Ä¢	handles direct transaction submission

‚∏ª

3. Permissions

The extension MUST NOT request unnecessary permissions.

Allowed:
	‚Ä¢	activeTab
	‚Ä¢	storage
	‚Ä¢	scripting
	‚Ä¢	notifications
	‚Ä¢	fetch
	‚Ä¢	host permissions limited to user-provided TBC endpoint
	‚Ä¢	optional dApp pages where x402 messages reside

Forbidden:
	‚Ä¢	clipboardRead
	‚Ä¢	clipboardWrite
	‚Ä¢	webRequestBlocking
	‚Ä¢	intercepting wallet popups
	‚Ä¢	keylogging or DOM scraping

‚∏ª

4. Extension Event Flow
	1.	Receive payment_required from a content script bridge
	2.	Construct TGP envelope
	3.	Background worker sends QUERY ‚Üí TBC
	4.	TBC sends ACK
	5.	Background worker builds raw TX
	6.	Extension popup asks user: ‚ÄúProceed with TGP session?‚Äù
	7.	TX forwarded to wallet (EIP-1193)
	8.	Wallet signs
	9.	Background worker routes signed tx
	10.	Extension logs session + receipt metadata

‚∏ª

5. TBC Communication Requirements

Extension MUST:
	‚Ä¢	use HTTPS
	‚Ä¢	validate certificates
	‚Ä¢	only communicate with user-configured endpoints
	‚Ä¢	handle timeouts gracefully
	‚Ä¢	use short-lived fetch() calls

Extension MUST NOT:
	‚Ä¢	maintain persistent WebSocket connections unless user explicitly enables ‚ÄúAgent Mode‚Äù
	‚Ä¢	beacon to third-party servers

‚∏ª

6. Security Requirements

Extension MUST NOT:
	‚Ä¢	request seed words
	‚Ä¢	handle private keys
	‚Ä¢	persist sensitive transaction data
	‚Ä¢	alter wallet signing flows
	‚Ä¢	fake transaction confirmations
	‚Ä¢	intercept wallet popups

Extension MUST:
	‚Ä¢	be open source (recommended but not required)
	‚Ä¢	clearly disclose all network endpoints
	‚Ä¢	support isolated worlds (content scripts cannot access page JS directly)

‚∏ª

7. Wallet Interaction

Extension MUST:
	‚Ä¢	detect wallet presence
	‚Ä¢	send standard transaction requests via EIP-1193
	‚Ä¢	never bypass user approval

Extension MAY:
	‚Ä¢	display a ‚ÄúTGP NAT Present‚Äù signal inside the extension popup
	‚Ä¢	expose session info to the wallet via custom events (optional)

‚∏ª

8. Compliance Across Browsers

Chrome MV3
	‚Ä¢	use Service Worker
	‚Ä¢	no persistent background scripts

Firefox
	‚Ä¢	may allow background pages
	‚Ä¢	same security rules

Safari
	‚Ä¢	WKWebExtension; permissions heavily restricted
	‚Ä¢	must avoid injected scripts that read sensitive fields