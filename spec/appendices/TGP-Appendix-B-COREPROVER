Appendix B – CoreProver Reference Profile (Informative)

E.1 Purpose

The CoreProver reference profile defines a canonical single-sided escrow and legal-receipt flow used by enterprises and marketplaces where a buyer funds first and a seller issues a binding commitment before delivery.

It demonstrates how TGP’s Prover abstraction (§15) maps real-world commerce semantics without imposing them on all networks.
Gateways and domains MAY substitute any compatible IProver implementation; CoreProver serves as the default behavioral model.

⸻

E.2 Profile Identifier

Field	Value
ProverID	ESCROW_COMMITMENT_V0
ProfileHash	keccak256("CoreProver EscrowCommitment V0 spec 2025-11")
Capabilities	`ESCROW


⸻

E.3 Actors & States

Actor	Description
Buyer	Initiates payment; funds a PreAuth via the Prover.
Seller	Accepts the PreAuth and issues a Commitment (receipt).
Gateway	Mediates policy, records proofs, and closes positions.
Prover	Holds or verifies escrowed value and transitions state.

State Machine:

PREAUTH_OPEN ──► COMMITTED ──► (FULFILLED | REFUNDED | DISPUTED | EXPIRED)


⸻

E.4 Structs (Conceptual ABI)

struct PreAuth {
    address buyer;
    address seller;
    address asset;
    uint256 amount;
    uint64  createdAt;
    uint64  expiry;          // refund if not accepted
    bytes32 orderId;         // optional buyer reference
    bool    accepted;
    FulfillmentPreference fulfillmentPref;
}

enum FulfillmentPreference { NONE, OPTIONAL, REQUIRED }

struct Commitment {
    bytes32 preAuthId;
    address seller;
    bytes32 termsHash;       // hash of offer terms or invoice
    bytes32 descriptionHash; // hash of product/service summary
    string  termsURI;        // optional off-chain link (IPFS/HTTPS)
    bool    fulfilled;
    uint64  committedAt;
}

struct Fulfillment {
    bytes32 commitmentId;
    string[] attachmentURIs; // NFT IDs, QR links, docs
    bytes32 attachmentsHash; // integrity checksum
    uint64  fulfilledAt;
}


⸻

E.5 Lifecycle Flow
	1.	Pre-Authorization
	•	Buyer’s gateway or agent calls
openPosition(params=PreAuth)
locking funds inside the Prover.
	•	If not accepted before expiry, funds auto-refund.
	•	Returns positionId (= preAuthId).
	2.	Seller Commitment
	•	Seller’s gateway accepts via
closePosition(preAuthId, params=Commitment)
which marks funds as owned by the seller and emits a SellerCommitment event.
	•	This step produces the legally binding receipt and prevents timeout reversion.
	3.	Optional Fulfillment
	•	If fulfillmentPref != NONE, seller MAY (or MUST) publish artifacts:
	•	NFT tickets, QR codes, shipment docs, etc.
	•	Seller or gateway calls
closePosition(commitmentId, params=Fulfillment)
linking attachments.
	4.	Proof & Settle
	•	Prover emits a verifiable Fulfilled(positionId, attachmentsHash) event.
	•	Gateways include the resulting hash in TGP PROOF/SETTLE messages and in TDR logs.

⸻

E.6 JSON Example -- Minimal Fulfillment Transaction

{
  "tgp_version": "0.1",
  "message_type": "SELECT",
  "attributes": {
    "prover_id": "ESCROW_COMMITMENT_V0",
    "prover_profile": "FULFILLMENT_OPTIONAL"
  },
  "l8_value": {
    "amount": "4.75",
    "asset": {"symbol": "USDC", "address": "0x..."},
    "settlement": {"mode": "escrow", "escrow_contract": "0xProverA"}
  },
  "l9_identity": {
    "entities": {
      "buyer": "did:loe:alice",
      "seller": "did:loe:zailmail"
    }
  },
  "l10_policy": {
    "rules": {"allow_networks": [{"family": "EVM","chain_id":369}]},
    "compliance": ["KYC"]
  },
  "coreprover": {
    "preAuth": {
      "expiry": "2025-12-01T12:00:00Z",
      "orderId": "ZM-2025-7741"
    }
  }
}


⸻

E.7 Behavioral Guarantees

Condition	Effect
Seller never accepts before expiry	Funds → auto-refund to buyer.
Seller accepts → commitment created	Funds released to seller; buyer can’t revert via timeout.
Seller publishes fulfillment	attachmentsHash logged in TDR; receipt complete.
Dispute or refund policy	Handled by gateway’s policy engine and/or RIG/insurance overlay.


⸻

E.8 Audit & TDR Fields

When this profile is used, TDR entries MUST include:

prover_id=ESCROW_COMMITMENT_V0
prover_profile=FULFILLMENT_{OPTIONAL|REQUIRED}
prover_position=preAuthId
commitment_hash=sha256(termsHash||descriptionHash)
attachments_hash=attachmentsHash (if any)
receipt_hash=H(L8||L9||L10)


⸻

E.9 Compliance and Legal Use

CoreProver’s Commitment object is designed to be exportable as a digitally signed receipt or invoice under electronic-signature laws (e.g., UETA, eIDAS).
Domains MAY notarize the Commitment and Fulfillment hashes through a Proof Project or similar notary service for off-chain enforceability.

⸻

E.10 Extensibility

Future profiles (ESCROW_COMMITMENT_V1, _V2) MAY extend:
	•	multi-asset baskets,
	•	split payments,
	•	group-escrow / DAO fulfillment,
	•	embedded ZK buyer-proof circuits (§ZKB-01).

⸻

(end of Appendix E – CoreProver Reference Profile)